<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Du lịch Việt</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
      }

      .banner {
        width: 100%;
        height: 300px;
        object-fit: cover;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .buttons {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 20px;
      }

      .button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }

      .button:hover {
        background-color: #0069d9;
      }

      .button + .button {
        margin-left: 10px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ccc;
      }

      th {
        background-color: #f0f0f0;
      }

      img {
        width: 100px;
        height: 100px;
        object-fit: cover;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
      }

      .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        border-radius: 5px;
        width: 70%;
        align-items: center;
        justify-content: center;
      }
      .modal-header {
        margin: 10px 420px 30px;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }

      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      .form-group {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        flex-wrap: no-wrap;
        gap: 0.5rem;
        justify-content: flex-end;
        align-items: center;
        justify-content: center;
      }

      label {
        width: 15%;
      }
      input {
        width: 35%;
      }
      input[type="file"] {
        width: 35%;
      }
    </style>
  </head>
  <body>
    <img src="banner.jpg" alt="Banner" class="banner" />
    <div class="container">
      <div class="buttons">
        <div class="button" id="login">Đăng nhập</div>
        <div class="button" id="new-tour">Mở tour mới</div>
      </div>
      <h1>DANH SÁCH TOUR - DU LỊCH VIỆT</h1>
      <table id="tour-list">
        <thead>
          <tr>
            <th>STT</th>
            <th>Mã tour</th>
            <th>Hành trình</th>
            <th>Ngày khởi hành</th>
            <th>Thời gian</th>
            <th>Giá tour</th>
            <th>Ảnh đại diện</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- Đây là modal window cho mở tour mới -->
      <div id="modal" class="modal">
        <div class="modal-content">
          <span class="close">×</span>
          <h2 class="modal-header">THÔNG TIN TOUR</h2>
          <form id="tour-form">
            <div class="form-group">
              <label for="code">Mã tour:</label>
              <input
                placeholder="Nhập mã tour (HCM-HUE-08-2023)"
                type="text"
                id="code"
                name="code"
                pattern="[A-Za-z]{3}-[A-Za-z]{3}-(0[1-9]|1[0-2])-[0-9]{4}"
                required
              />
            </div>
            <div class="form-group">
              <label for="route">Hành trình:</label>
              <input
                placeholder="Nhập hành trình"
                type="text"
                id="route"
                name="route"
                required
              />
            </div>
            <div class="form-group">
              <label for="date">Ngày khởi hành:</label>
              <input type="date" id="date" name="date" required />
            </div>
            <div class="form-group">
              <label for="duration">Thời gian:</label>
              <input
                placeholder="Nhập thời gian đi (4 ngày 3 đêm)"
                type="text"
                id="duration"
                name="duration"
                required
              />
            </div>
            <div class="form-group">
              <label for="price">Giá tour:</label>
              <input
                placeholder="Số >0"
                type="number"
                id="price"
                name="price"
                min="1"
                required
              />
            </div>
            <div class="form-group">
              <label for="image">Ảnh đại diện:</label>
              <input
                type="file"
                id="image"
                name="image"
                accept="image/*"
                required
              />
            </div>
            <div class="form-group">
              <input type="submit" value="Lưu" />
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Lấy các phần tử cần thiết từ HTML
      var modal = document.getElementById("modal");
      var newTourButton = document.getElementById("new-tour");
      var closeButton = document.getElementsByClassName("close")[0];
      var tourForm = document.getElementById("tour-form");
      var tourList = document.getElementById("tour-list");

      // Định nghĩa một biến để lưu số thứ tự của tour
      var stt = 0;

      // Hàm để tạo một hàng mới cho bảng danh sách tour
      function createRow(tour) {
        // Tạo một phần tử tr
        var row = document.createElement("tr");
        // Tạo các phần tử td cho từng cột
        var sttCell = document.createElement("td");
        var codeCell = document.createElement("td");
        var routeCell = document.createElement("td");
        var dateCell = document.createElement("td");
        var durationCell = document.createElement("td");
        var priceCell = document.createElement("td");
        var imageCell = document.createElement("td");
        // Tạo một phần tử img cho ảnh đại diện
        var image = document.createElement("img");
        // Gán giá trị cho các phần tử td từ đối tượng tour
        sttCell.textContent = tour.stt;
        codeCell.textContent = tour.code;
        routeCell.textContent = tour.route;
        dateCell.textContent = tour.date;
        durationCell.textContent = tour.duration;
        priceCell.textContent = tour.price;
        // Đọc file ảnh từ đối tượng tour và gán cho src của img
        var reader = new FileReader();
        reader.onload = function (e) {
          image.src = e.target.result;
        };
        reader.readAsDataURL(tour.image);
        // Thêm phần tử img vào phần tử td cho ảnh đại diện
        imageCell.appendChild(image);
        // Thêm các phần tử td vào phần tử tr
        row.appendChild(sttCell);
        row.appendChild(codeCell);
        row.appendChild(routeCell);
        row.appendChild(dateCell);
        row.appendChild(durationCell);
        row.appendChild(priceCell);
        row.appendChild(imageCell);
        // Trả về phần tử tr
        return row;
      }

      // Hàm để xử lý sự kiện khi nhấn nút mở tour mới
      function openModal() {
        // Hiển thị modal window
        modal.style.display = "block";
      }

      // Hàm để xử lý sự kiện khi nhấn nút đóng modal window
      function closeModal() {
        // Ẩn modal window
        modal.style.display = "none";
      }

      // Hàm để kiểm tra thời gian có định dạng số ngày số đêm và không >1
      function checkDuration(duration) {
        // Tạo một biểu thức chính quy để kiểm tra định dạng
        var regex = /^([1-9][0-9]*) ngày ([1-9][0-9]*) đêm$/;
        // Kiểm tra thời gian có khớp với biểu thức chính quy không
        var match = duration.match(regex);
        // Nếu có khớp, tiếp tục kiểm tra điều kiện số ngày - số đêm <=1 và số đêm - số ngày <=1
        if (match) {
          // Lấy giá trị của số ngày và số đêm từ kết quả khớp
          var days = parseInt(match[1]);
          var nights = parseInt(match[2]);
          // Kiểm tra điều kiện
          if (Math.abs(days - nights) <= 1) {
            // Nếu điều kiện thoả mãn, trả về true
            return true;
          } else {
            // Nếu điều kiện không thoả mãn, trả về false
            return false;
          }
        } else {
          // Nếu không khớp, trả về false
          return false;
        }
      }

      // Hàm để xử lý sự kiện khi submit form mở tour mới
      function submitForm(event) {
        // Ngăn chặn hành động mặc định của form (gửi dữ liệu và tải lại trang)
        event.preventDefault();
        // Lấy giá trị của ô nhập thời gian
        var duration = tourForm.duration.value;
        // Kiểm tra thời gian có hợp lệ không
        if (checkDuration(duration)) {
          // Nếu hợp lệ, tiếp tục xử lý như bình thường
          // Tăng số thứ tự của tour lên 1
          stt++;
          // Tạo một đối tượng tour từ các giá trị nhập vào form
          var tour = {
            stt: stt,
            code: tourForm.code.value,
            route: tourForm.route.value,
            date: tourForm.date.value,
            duration: duration,
            price: tourForm.price.value,
            image: tourForm.image.files[0],
          };
          // Tạo một hàng mới cho bảng danh sách tour từ đối tượng tour
          var row = createRow(tour);
          // Thêm hàng mới vào phần tử tbody của bảng
          tourList.tBodies[0].appendChild(row);
          // Ẩn modal window
          closeModal();
          // Xóa các giá trị nhập vào form
          tourForm.reset();
        } else {
          // Nếu không hợp lệ, hiển thị thông báo lỗi cho người dùng
          alert(
            "Thời gian không hợp lệ. Vui lòng nhập lại theo định dạng số ngày số đêm và số ngày đêm không cách nhau >1 (4 ngày 3 đêm)"
          );
        }
      }

      // Thêm sự kiện click cho nút mở tour mới
      newTourButton.addEventListener("click", openModal);

      // Thêm sự kiện click cho nút đóng modal window
      closeButton.addEventListener("click", closeModal);

      // Thêm sự kiện submit cho form mở tour mới
      tourForm.addEventListener("submit", submitForm);
    </script>
  </body>
</html>
